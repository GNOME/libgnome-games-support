libgames-scores is a small library intended for internal use by GNOME Games.
This library was introduced at the beginning of the GNOME 3.14 development
cycle.

Prior to GNOME 3.8, the games were all shipped in one large package, and until
GNOME 3.6, they shared a common support library, libgames-support. This used
to contain several different files, but it shrunk, and in GNOME 3.4 was only
used for scores, and only for games that had not yet been ported from C to Vala:
Five or More, Nibbles, Robots, and Tali. Each Vala game used its own, much
simpler implementation of a scores dialog, mostly copy-pasted from each other.
For GNOME 3.6, libgames-support was removed and the remaining scores files were
copied into the four games still using them. Thus the games that track high
scores have a high amount of code duplication, though there are two different
sets of code involved. Making the same change in each individual games is
starting to get old, so the primary goal of this library is to eliminate that
code duplication.

A secondary goal is to clean up inconsistencies with how scores work in the
various game. As of GNOME 3.12, the Vala games handle scores differently than
the C games in several ways:

* The Vala games store a history of every game ever played. The C games store a
  history of only the top 10 games.

* The Vala games store history in one single file, and store the score category
  (usually a difficulty level or map) as a column in that file. The C games use
  different files for each category.

* When adding a new score, different games offer different buttons. New Game is
  consistent, but some games have Close (the score dialog) while others offer
  Quit (the application).

* The Vala games store scores in the user's home directory and do not track
  player names. Until GNOME 3.12, the C games stored scores in /var/games. The
  scores files were owned by the games user (by default), the files tracked the
  name of the player who earned the high score (which could be set at the time
  the score was earned), and the game binaries were setgid for the games user.
  As of 3.12, the C games began to use the user's home directory to store scores
  and stopped tracking player names, to match the more modern Vala games.

This library is based on the older code currently used by the C games, mostly
written by Callum McKenzie. Scores are saved in the home directory, in separate
files per category. All scores are saved, but only the top 10 are presented to
the user. In contrast to GNOME 3.12, the player's name is stored with his
scores, so if Player A wins a game while logged into Player B's user account, he
can get credit. (The scores are still tied to Player B's account, since they are
saved in his home directory.) We may also want to use the same buttons in the
score dialog for different games, but maybe not: for some games, you may want to
close the window to look at your result, while for others it might make more
sense to just offer a quit button.

Players upgrading from GNOME 3.12 should not lose any scores. Scores from the
Vala games will be automatically detected and imported into the new format.
Scores from the 3.12 C games use the same format, except do not store the
player's name. These will be converted to use the name of the current user,
which is the best we can do. This library does not read scores from the C games
prior to GNOME 3.12.

A future goal is to support difficulty level suggestions. If a player is winning
a lot of games on a lower difficulty level, or losing all the time on a
higher one, we want to intelligently present a suggestion to change the
difficulty, so the player doesn't need to ever look in the game's preferences
dialog. (We do not want to present that same suggestion more than once or twice,
if the player declines.) Therefore, we want to save a history of ALL games, even
though we only present the top 10 to the user.

Michael Catanzaro

April 5, 2014
